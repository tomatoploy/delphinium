<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Anuphan&display=swap" rel="stylesheet">
  <title>for p'earth</title>
</head>
<body>
  <!-- <div class="floating-flowers"></div> -->
  <div id="cassetteBox" class="cassette">
    <div class="top-bar">
      <div class="waveform">
        <div class="message" style="margin: 12px 5px; color: rgba(256, 256, 256, 0.5); font-size: 10px;">05/07/2025</div>
      </div>
      <div class="buttons">
        <button>æ¯æ—¥ã®ã†ãŸ</button> <!-- song kub-->
        <button>å›ã¸ã®æ‰‹ç´™</button> <!-- letter -->
        <button id="photoBtn">å†™çœŸ</button>
      </div>
    </div>
    <p style="font-size: 12px; font-weight: 200;">to : my world Ëšâ—â™¡</p>
    <div class="player">
      <div class="tape-window">
        <video id="videoBg" class="video-bg" muted playsinline loop>
          <source src="video.mp4" type="video/mp4">
        </video>
        <!-- <div class="reel" id="leftReel"></div>
        <div class="reel" id="rightReel"></div> -->
      </div>
      <div class="deco">
        <div class="power-btn" id="powerBtn"></div>
        <audio id="audio" src="song.mp3"></audio>
        <audio id="sfx-typewriter" src="typewriter.mp3"></audio>
        <audio id="sfx-envelope" src="envelope-open.mp3"></audio>
        <audio id="sfx-click" src="cassette-click.mp3"></audio>
        <div class="speaker"></div>
      </div>
    </div>
    <div class="message">
      <p style="margin-bottom: 0px;">ä»Šæ—¥ã‚‚æœˆãŒãã‚Œã„ã§ã™ã­ã€‚</p>
      <p style="margin: 0px 0px 5px 0px">2 months with you â™¡</p>
    </div>
  </div>

  <!-- Polaroid -->
  <div id="photoOverlay" class="photo-overlay hidden">
    <button class="close-btn">âœ–</button>
    <div class="polaroid-container">
      <div class="polaroid">
        <img src="gallery.png" alt="Memory 1">
      </div>
    </div>
  </div>

  <script>
  const audio = document.getElementById('audio');
  const leftReel = document.getElementById('leftReel');
  const rightReel = document.getElementById('rightReel');
  const powerBtn = document.getElementById('powerBtn');
  const sfxTypewriter = document.getElementById('sfx-typewriter');
  const sfxEnvelope = document.getElementById('sfx-envelope');
  const tapeWindow = document.querySelector('.tape-window');
  const photoOverlay = document.getElementById('photoOverlay');
  const cassetteBox = document.getElementById('cassetteBox');
  const video = document.getElementById('videoBg');
  const sfxClick = document.getElementById('sfx-click');
  const buttons = document.querySelectorAll('.buttons button');
  let isPlaying = false;

  // à¹€à¸¥à¹ˆà¸™ / à¸«à¸¢à¸¸à¸”à¹€à¸à¸¥à¸‡ : à¸­à¸±à¸™à¹€à¸à¹ˆà¸²
  // powerBtn.addEventListener('click', () => {
  //   sfxClick.currentTime = 0;
  //   sfxClick.play();
  //   if (!isPlaying) {
  //     setTimeout(() => {
  //     audio.play();
  //     leftReel.classList.add('playing');
  //     rightReel.classList.add('playing');
  //     isPlaying = true;
  //   }, 1000);
  //   } else {
  //     audio.pause();
  //     leftReel.classList.remove('playing');
  //     rightReel.classList.remove('playing');
  //     isPlaying = false;
  //   }
  // });

  powerBtn.addEventListener('click', () => {
    sfxClick.currentTime = 0;
    sfxClick.play();

    if (!isPlaying) {
      setTimeout(() => {
        // à¸­à¸¢à¹ˆà¸² reset currentTime
        audio.play();
        video.play();
        video.classList.add('show');
        isPlaying = true;
      }, 1000);
    } else {
      audio.pause();
      video.pause();
      video.classList.remove('show');
      isPlaying = false;
    }
  });

  // à¸à¸´à¸¡à¸à¹Œà¸—à¸µà¸¥à¸°à¸•à¸±à¸§à¹à¸šà¸šà¸—à¸µà¸¥à¸°à¸šà¸£à¸£à¸—à¸±à¸”
  function typeWriterLines(lines, element, lineDelay = 1400, charSpeed = 20) {
    let lineIndex = 0;

    function typeLine() {
      if (lineIndex >= lines.length) {
        sfxTypewriter.pause(); // à¸«à¸¢à¸¸à¸”à¹€à¸ªà¸µà¸¢à¸‡
        sfxTypewriter.currentTime = 0;
        return;
      }

      let charIndex = 0;
      const line = lines[lineIndex];
      const span = document.createElement("div");
      element.appendChild(span);

      const typingInterval = setInterval(() => {
        span.innerHTML += line.charAt(charIndex);
        charIndex++;

        if (charIndex >= line.length) {
          clearInterval(typingInterval);
          lineIndex++;
          setTimeout(typeLine, lineDelay);
        }
      }, charSpeed);
    }
    sfxTypewriter.currentTime = 0;
    sfxTypewriter.play();
    sfxTypewriter.loop = true;
    typeLine();
  }


  buttons.forEach((btn, index) => {
    btn.addEventListener('click', () => {
      if (!isPlaying) {
        audio.currentTime = 0;
        video.currentTime = 0;
        audio.play();
        video.play();
        video.classList.add('show');
        isPlaying = true;
      }

      if (index === 1) {
        sfxEnvelope.currentTime = 0;
        sfxEnvelope.play();

        setTimeout(() => {
          // à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸‚à¸­à¸‡à¹€à¸à¹ˆà¸²à¸—à¸´à¹‰à¸‡à¸à¹ˆà¸­à¸™
          const oldContent = tapeWindow.querySelector('#letterText');
          if (oldContent) oldContent.remove();

          // à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸”à¸«à¸¡à¸²à¸¢ (à¸‹à¹‰à¸­à¸™à¸šà¸™à¸§à¸´à¸”à¸µà¹‚à¸­)
          const letterDiv = document.createElement("div");
          letterDiv.id = "letterText";
          letterDiv.style.fontFamily = "'Anuphan', sans-serif";
          letterDiv.style.padding = "10px";
          letterDiv.style.fontSize = "11.5px";
          letterDiv.style.lineHeight = "1.8";
          letterDiv.style.color = "#fff";
          letterDiv.style.textAlign = "center";
          letterDiv.style.position = "absolute";
          letterDiv.style.zIndex = "1";

          tapeWindow.appendChild(letterDiv);

          const letterLines = [
            `à¹€à¸¢à¹ˆ à¸«à¸§à¸±à¸”à¸”à¸µà¸„à¸±à¸šà¹€à¸—à¸­ âœ¨; âº â‚Š`,
            `à¸§à¸±à¸™à¸™à¸µà¹‰à¸à¹‡à¸„à¸£à¸šà¸£à¸­à¸š 2 à¹€à¸”à¸·à¸­à¸™à¹à¸¥à¹‰à¸§à¸™à¸°à¸„à¸°`,
            `à¹€à¸„à¹‰à¸²à¸‚à¸­à¸šà¸„à¸¸à¸“à¹€à¸—à¸­à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¸¡à¸²à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸Šà¸µà¸§à¸´à¸•à¹€à¸„à¹‰à¸² à¸­à¸¢à¸¹à¹ˆà¸à¸±à¸šà¹€à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¹ƒà¸™à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸¸à¸‚à¹à¸¥à¸°à¸—à¸¸à¸à¸‚à¹Œ
            à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¹€à¸—à¸­à¹€à¸¥à¹ˆà¸²à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸ªà¸™à¸¸à¸à¹ƒà¸«à¹‰à¹€à¸„à¹‰à¸²à¸Ÿà¸±à¸‡à¸«à¸¥à¸²à¸¢à¹€à¸£à¸·à¹ˆà¸­à¸‡à¹€à¸¥à¸¢ à¹€à¸„à¹‰à¸²à¸Šà¸­à¸šà¸Ÿà¸±à¸‡à¸—à¸µà¹ˆà¹€à¸—à¸­à¹€à¸¥à¹ˆà¸²à¸™à¸° à¸­à¸¢à¸²à¸à¸­à¸¢à¸¹à¹ˆà¸Ÿà¸±à¸‡à¹€à¸—à¸­à¹€à¸¥à¹ˆà¸²à¹€à¸¢à¸­à¸° à¹† à¹€à¸¥à¸¢
            à¸‚à¸­à¸šà¸„à¸¸à¸“à¹€à¸—à¸­à¸—à¸µà¹ˆà¸„à¸­à¸¢à¸‹à¸±à¸à¸à¸­à¸£à¹Œà¸•à¹€à¸„à¹‰à¸²à¸­à¸¢à¸¹à¹ˆà¹€à¸ªà¸¡à¸­ à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¹ƒà¸™à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸—à¸­à¹€à¸«à¸™à¸·à¹ˆà¸­à¸¢ à¹€à¸—à¸­à¸à¹‡à¸¢à¸±à¸‡à¸•à¸²à¸¡à¹ƒà¸ˆà¹€à¸„à¹‰à¸²à¹€à¸ªà¸¡à¸­
            à¹à¸¥à¹‰à¸§à¸à¹‡à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¸£à¸±à¸à¹€à¸„à¹‰à¸²à¸™à¸° à¸„à¸£à¸±à¹‰à¸‡à¸™à¸µà¹‰à¸à¹‡à¸‚à¸­à¸à¸²à¸à¸•à¸±à¸§à¸”à¹‰à¸§à¸¢à¸„à¸±à¹‰à¸šğŸ’`,
            `à¸ªà¸¸à¸‚à¸ªà¸±à¸™à¸•à¹Œà¸§à¸±à¸™à¸„à¸£à¸šà¸£à¸­à¸š 2 à¹€à¸”à¸·à¸­à¸™à¸™à¸°à¸„à¸°âŒ’ğŸ§šğŸ»â€â™€ï¸â•`,
          ];
          // à¸£à¸±à¸à¹à¸¥à¸°à¸„à¸´à¸”à¸–à¸¶à¸‡à¹€à¸—à¸­à¸™à¸°
          // à¸ˆà¸²à¸ ğŸ°
          // 05/07/2025

          typeWriterLines(letterLines, letterDiv, 1400, 30);
        }, 800);
      } else {
        // à¸¥à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸”à¸«à¸¡à¸²à¸¢à¸­à¸­à¸ (à¸–à¹‰à¸²à¸¡à¸µ)
        const oldContent = tapeWindow.querySelector('#letterText');
        if (oldContent) oldContent.remove();
      }
    });
  });

  // à¹à¸ªà¸”à¸‡ overlay
  document.getElementById('photoBtn').addEventListener('click', () => {
    cassetteBox.classList.add('slide-down');
    setTimeout(() => {
      cassetteBox.classList.add('hidden');
    }, 600);
    photoOverlay.classList.remove('hidden');
    setTimeout(() => {
      photoOverlay.classList.add('show');
    }, 10);
  });

  // à¸›à¸´à¸” overlay
  document.querySelector('.close-btn').addEventListener('click', () => {
    photoOverlay.classList.remove('show');
    setTimeout(() => {
      photoOverlay.classList.add('hidden');
      cassetteBox.classList.remove('slide-down');
      cassetteBox.classList.remove('hidden');
      cassetteBox.classList.add('slide-up');
      setTimeout(() => {
        cassetteBox.classList.remove('slide-up');
      }, 600);
    }, 600);
  });

  const flowerContainer = document.querySelector('.floating-flowers');

  function createFloatingFlower() {
    const flower = document.createElement('div');
    flower.classList.add('flower');
    flower.textContent = 'âœ¿';

    const size = Math.random() * 16 + 16; // 16px - 32px
    const left = Math.random() * 100; // %
    const duration = Math.random() * 10 + 10; // 10 - 20s
    const delay = Math.random() * 5; // 0 - 5s

    flower.style.left = `${left}vw`;
    flower.style.fontSize = `${size}px`;
    flower.style.animationDuration = `${duration}s`;
    flower.style.animationDelay = `${delay}s`;

    flowerContainer.appendChild(flower);

    setTimeout(() => {
      flower.remove();
    }, (duration + delay) * 1000);
  }

  setInterval(createFloatingFlower, 800);

  audio.addEventListener('ended', () => {
    audio.currentTime = 0;
    audio.play();
  });
  </script>
</body>
</html>